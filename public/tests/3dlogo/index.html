<!DOCTYPE html>
<html>

<head>
	<title>ProtoAR Mobile w/ Kinect</title>

	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
	<meta name="mobile-web-app-capable" content="yes">
	<meta id="theme-color" name="theme-color" content="#000000">

	<link rel="icon" type="image/png" href="../favicon.ico" />
	<link rel="apple-touch-icon" href="../favicon.ico" />

	<link href="//fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />

	<style>
		html,
		body {
			min-width: 100%;
			min-height: 100%;
		}
		
		body {
			background: black;
			color: gray;
			margin: 0px;
			padding: 0px;
			overflow: hidden;
			font-family: 'Open Sans';
			user-select: none;
			overflow: hidden;
		}
		
		video {
			width: 100%;
			height: 100%;
		}
		
		.hologram {
			position: absolute;
			left: 200px;
			top: 200px;
			opacity: 0.8;
		}
		
		#debug {
			position: absolute;
			right: 0;
			top: 0;
		}
	</style>

	<script type="text/javascript" src="/.common/require.js"></script>
</head>

<body>
	<div id="scene">
		<div id="debug"></div>
		<video autoplay id="camera"></video>
		<img id="logo" class="hologram" src="../../../mi2lab_logo_transparent.png" width="100" />
		<!--<img id="slide" class="hologram" src="slide.jpg" />-->
	</div>

	<script>
		var debug = document.querySelector("#debug");
		var video = document.querySelector("video#camera");
		var hologram = document.querySelector("#logo");
		//var hologram = document.querySelector("#slide");

		function getRightHand(bodyFrame) {
			var joint = false;
			bodyFrame.bodies.forEach(function (body) {
				if (body.tracked && !joint) {
					//console.log(body.joints[11]);
					joint = body.joints[11];
				}
			});
			return joint;
		}

		function getDistance(joint) {
			return Math.sqrt(
				joint.cameraX * joint.cameraX +
				joint.cameraY * joint.cameraY +
				joint.cameraZ * joint.cameraZ
			);
		}

		var hand;

		function updateHologram() {
			if (hand.cameraZ < 0.75) {
				hologram.style.display = 'none';
			}
			else {
				var x = (200 - Math.trunc(hand.depthX * 1000) / 2) + "px";
				var y = (200 - Math.trunc(hand.depthY * 800) / 2) + "px";
				var translate = "translate(" + x + ", " + y + ")";
				//hologram.style.transform = translate;
				var z = 4.5 - hand.cameraZ;
				var scale = "scale(" + (Math.round(z * 100) / 100) + ")";
				hologram.style.transform = translate + scale;
				console.log(hologram.style.transform);
				debug.innerHTML = hologram.style.transform;
				hologram.style.display = 'block';
			}
		}

		require(["camera", "xd"]).then(function () {
			var camera = new Camera({
				camera: -1,
				video: video
			});

			XD.on("kinect", function (msg) {
				hand = getRightHand(msg.bodyFrame);
				requestAnimationFrame(updateHologram);
			});
		});
	</script>
</body>

</html>